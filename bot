#!/usr/bin/env python

from threading import Thread
from flexo import irc
from code import interact

def run_bot(bot):
    bot.initialize()
    bot.connect()
    bot.receiver()

def run_console(bot):
    interact(local={ 'bot': bot })

def main(hostname='localhost', port=6667, debug=False):
    bot = irc.Bot((hostname, port))
    bot_thread = Thread(target=run_bot, name='Bot', args=(bot,))
    bot_thread.start()

    console_thread = Thread(target=run_console, name='Console', args=(bot,))
    console_thread.start()

    bot_thread.join()

if __name__ == '__main__':
    import sys, getopt

    kwargs = {}
    short_opts = 'dh:p:'

    opts, args = getopt.getopt(sys.argv[1:], short_opts)
    for opt, val in opts:
        if opt == '-d':
            kwargs['debug'] = True

        elif opt == '-h':
            kwargs['hostname'] = val
        elif opt == '-p':
            kwargs['port'] = int(val)

    main(**kwargs)
